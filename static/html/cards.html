<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>Filebed</title>
    <link rel="stylesheet" type="text/css" href="/static/webuploader.css" />
    <link rel="stylesheet" href="https://www.layuicdn.com/layui/css/layui.css" media="all">
    <link rel="stylesheet" type="text/css" href="/static/layui-theme.css" />
    <link rel="stylesheet" type="text/css" href="/static/style.css" />

    <style type="text/css">
    div {
        padding: 0px;
        margin: 0px;
    }
    @media screen and (min-width: 980px){
        body .CardBox {
            width: 260px;
            margin: 20px 15px;
        }
    }
    #CardListBox {
        width: 90%;
        margin: 0 auto;
    }
    .CardBox {
        margin: 1em auto;
        box-shadow: 0 2px 3px 0 rgba(7, 17, 27, 0.1);
        transition: .3s all linear;
        border: 1px solid #e4ecf3;
        border-radius: 4px;
        background-color: #fff;
        height: 320px;
        float: left;
    }
    .activeBox {
        box-shadow: 0 0 20px rgba(0,0,0,.15);
        transition: box-shadow .3s;
    }
    .CardHeader {
        padding: 0px;
        margin: 0;
        height: 160px;
    }
    .CardBody {
        padding: 0.5em;
        height: 100px;
        font-size: 14px;
    }
    .CardBody h2 {
        overflow: hidden;
        height: 40px;
    }
    .CardFooter {
        height: 30px;
        width: 100%;
        padding: 0 10px;
    }
    </style>
</head>

<body>
    <ul class="layui-nav" lay-filter="">
        <li class="layui-nav-item"><a href="/">上传</a></li>
        <li class="layui-nav-item"><a href="/files/">文件列表</a></li>
        <li class="layui-nav-item layui-this"><a href="/cards/">卡片列表</a></li>
        <li class="layui-nav-item"><a href="https://github.com/istommao/filebed" target="_blank">GitHub</a></li>
    </ul>

    <div id="CardListBox">

    </div>
    <script src="https://www.layuicdn.com/layui/layui.js" charset="utf-8"></script>
    <script>
    function readableBytes(bytes) {
        if (bytes == 0) {
            return '-'
        }

        var i = Math.floor(Math.log(bytes) / Math.log(1024)),
            sizes = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];

        return (bytes / Math.pow(1024, i)).toFixed(2) * 1 + ' ' + sizes[i];
    }

    var FileTypeList = ['video', 'audio', 'image'];

    layui.use('layer', function() {
        var $ = layui.jquery;
 
        $.get("/api/files/", function(resp) {
            var htmlContent = renderCardList(resp.data);
            $('#CardListBox').html(htmlContent);
        });
        $('#CardListBox').on({
            mouseenter: function () {
                $(this).addClass('activeBox');
            },
            mouseleave: function () {
                $(this).removeClass('activeBox');
            }
        }, ".CardBox");

        function renderCardList(dataset) {
            var htmlContent = '';

            $.each(dataset, function(key, val) {            
                var obj = dataset[key];
                fileType = obj.type;
                if (!FileTypeList.includes(obj.type)) {
                    fileType = 'unknown'
                }

                var item = '<div>' +
                    '<div class="CardBox">' +
                        '<div class="CardHeader"><img src="https://codingcat.top/media/info/default.png" width="100%"/></div>' +
                        '<div class="CardBody"><h2>' + obj.name + '</h2><br>' +
                        '<a href="' + obj.url + '" target="_blank">查看</a>' +
                        '</div>' +
                        '<div class="CardFooter"><img style="float: left" src="/static/fileicons/' + fileType + '.png" alt="" width="32" height="32"><div style="line-height:35px;float: left">' + readableBytes(obj.size) + '</div></div>' +
                    '</div></div>'

                htmlContent += item;
            });

            return htmlContent;
        }

    });
    </script>
</body>

</html>